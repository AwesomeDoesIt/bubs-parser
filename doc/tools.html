<html>
<head>
<title>Command-line tools</title>
</head>

<body>
<h2>Java Command-line Tools</h2>

<h3>Standalone Tools</h3>
<p>Since we live primarily in a Unix / Linux environment, we want
our shared Java tools to be as useful as possible from a bash
environment. We package most of these tools as standalone jars; that is,
the packaged jar file contains all its class dependencies (including
those from libraries in bsd-lib and lgpl-lib). We use a modified version
of the GenJar (http://genjar.sourceforge.org/) project to do the
dependency search and packaging. This is partly just an issue of
personal taste, but there are a couple motivations for this packaging
scheme:
<ul>
	<li>Including dependencies within each jar avoids classpath and
	versioning hell. It will result in duplicating the same class file
	within multiple jars, but disk space cheap and the time wasted on
	NoClassDefFoundErrors is not.</li>
	<li>It makes it easier to reference these tools from anywhere in
	the filesystem.</li>
</ul>
</p>

<h3>BaseCommandlineTool.java</h3>
<p>Most of our command-line tools extend this base class, which
provides a few significant functions to all tools:
<ul>
	<li><b>Argument / option parsing:</b> Subclasses must still
	specify the options they expect and the parameters which must be
	supplied, but as much of the parsing as possible is abstracted into <i>BaseCommandlineTool</i>.</li>

	<li><b>Input management:</b> The standard behavior for Unix tools
	is to read from file(s) specified as arguments or, if there are no such
	arguments, to read from standard input. BaseCommandlineTool abstracts
	this functionality for subclasses, and takes it one step further,
	automatically detecting <i>.gz</i> files and handling those as well, so
	subclasses do not have to implement either input file handling or
	decompression.</li>

	<li><b>Threading:</b> BaseCommandlineTool abstracts some of the
	functionality needed to multi-thread a tool. See <a
		href="javadoc/edu/ohsu/cslu/common/tools/LinewiseCommandlineTool.html">LinewiseCommandlineTool</a>
	and its subclasses for example usage.</li>
</ul>
See
<a href="javadoc/edu/ohsu/cslu/common/tools/BaseCommandlineTool.html">BaseCommandlineTool</a>
for implementation and usage details.
</p>

<h3>Building and Packaging</h3>
<p>Packaging of tools is handled by the <i>package.tool</i> target
in <i>build.xml</i>, but in general, you should be able to add new
packaging targets without dealing directly with that mechanism. The
package.tool target also creates the wrapper shell-script The wrapper
script is intended to be installed in some directory in your $PATH,
along with the jar file itself. You'll then be able to call the tool
directly from the command-line without typing the full path to the jar
file. You can of course execute the jar file yourself using 'java -jar
.../my-tool.jar ...' but the wrapper might save you some typing, and
under Cygwin it does the path conversion so that you can target files
using Cygwin / Unix paths and the appropriate windows path will be
passed to the Java program. (If you happen to look at the wrapper script
itself, you'll notice that most of the complexity is specifically to
handle Cygwin issues.)</p>

<p>The wrapper script is based on the template in <i>java/tools/script-template.sh</i>.
In theory, the resulting script works on OS X, Cygwin (under Windows),
Linux, Solaris, etc. (not that I test each of those often, but I think
I've tried each OS at some point in time. Let me know if it doesn't work
for you).</p>

<h3>Adding a tool build target.</h3>
<p>Adding a new tool is fairly easy, usually just requiring a single
additional target. The new target should call the <i>package.tool</i>
target as in this example (the distance calculation tool):</p>
<pre>
  &lt;target name="calculate-distances" depends="compile.java" description="Package Distance Calculation Tool"&gt;
    &lt;antcall target="package.tool"&gt;
      &lt;param name="root-class" value="edu.ohsu.cslu.tools.CalculateDistances" /&gt;
      &lt;param name="tool-name" value="calculate-distances" /&gt;
      &lt;param name="heap-size" value="512" /&gt;
    &lt;/antcall&gt;
  &lt;/target&gt;
</pre>

<br />
This target calls package.jar with three parameters:
<ul>
	<li><b>root-class</b> : The class with a 'main' method that we
	want to execute</li>
	<li><b>tool-name</b> : The name we want it packaged as. This
	should generally match the target name, although that's not enforced.</li>
	<li><b>heap-size</b> : The size of the required java heap in
	megabytes (defaults to 128 if not specified)</li>
</ul>

<p>If you want your new tool to be built as part of the standard
distribution, add it to the lengthy list of dependencies in the 'dist'
target at the bottom of <i>build.xml</i>.</p>

<font color="#777777"> Author: Aaron Dunlop<br />
Last Changed By: $Author: dunlopa $<br />
Revision: $Rev: 287 $<br />
Last Changed: $LastChangedDate: 2009-02-18 14:51:30 -0800 (Wed, 18 Feb
2009) $<br />
</font>
</body>
</html>